@model AppData.Models.NhanVien

@{
    Layout = "~/Views/Shared/_LayoutForAdmin.cshtml";
    ViewData["Title"] = "Create";
    AppData.Models.AssignmentDBContext dBContext = new AppData.Models.AssignmentDBContext();
}

<h1>Thêm mới nhân viên</h1>

<hr />
<div class="row">
    <div class="col-md-4">
        @if (ViewBag.ErrorMessage != null)
        {
            <div class="alert alert-danger">
                @ViewBag.ErrorMessage
            </div>
        }
        <form asp-action="Create" id="createForm">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group">
                <label asp-for="Ten" class="control-label">Tên nhân viên</label>
                <input asp-for="Ten" class="form-control" autocomplete="off" />
                <span asp-validation-for="Ten" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Email" class="control-label">Email</label>
                <input asp-for="Email" class="form-control" autocomplete="off" />
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="PassWord" class="control-label">Mật khẩu</label>
                <input asp-for="PassWord" type="password" class="form-control" autocomplete="off" name="PassWord" />
                <span asp-validation-for="PassWord" class="text-danger"></span>
                <div id="passwordErrorMessage" class="text-danger"></div>
            </div>

            <div class="form-group">
                <label asp-for="SDT" class="control-label">Số điện thoại</label>
                <input asp-for="SDT" class="form-control" autocomplete="off" name="SDT" />
                <span asp-validation-for="SDT" class="text-danger"></span>
                <div id="sdtErrorMessage" class="text-danger"></div>
            </div>

            <div class="form-group">
                <label asp-for="DiaChi" class="control-label">Địa chỉ</label>
                <input asp-for="DiaChi" class="form-control" autocomplete="off" />
                <span asp-validation-for="DiaChi" class="text-danger"></span>
            </div>

            <input type="hidden" asp-for="TrangThai" value="1" />
            <input type="hidden" asp-for="IDVaiTro" value="@(dBContext.VaiTros.FirstOrDefault(x => x.Ten == "Nhân viên")?.ID)" />

            <div class="form-group">
                <input type="submit" value="Thêm nhân viên" class="btn btn-success" />
            </div>
        </form>
    </div>
</div>

<br />
<button class="btn btn-primary">
    <a asp-action="Index" style="color:white; text-decoration:none;">Quay lại</a>
</button>

<script>
    $(document).ready(function () {
        // Xử lý sự kiện nhập liệu để xóa lỗi
        $("input[name='SDT']").on("input", function () {
            $(this).removeClass("is-invalid");
            $("#sdtErrorMessage").text("");
        });

        $("input[name='PassWord']").on("input", function () {
            $(this).removeClass("is-invalid");
            $("#passwordErrorMessage").text("");
        });

        // Xử lý khi submit form
        $("#createForm").submit(function (e) {
            var isValid = true;

            // Validate Password
            var passwordInput = $("input[name='PassWord']");
            var passwordValue = passwordInput.val();
            if (passwordValue.trim() !== "" && passwordValue.length < 8) {
                passwordInput.addClass("is-invalid");
                $("#passwordErrorMessage").text("Password phải có hơn 8 kí tự.");
                isValid = false;
            }

            // Validate SDT
            var sdtInput = $("input[name='SDT']");
            var sdtValue = sdtInput.val();
            var sdtRegex = /^(0[3|5|7|8|9]{1}[0-9]{7,8})$/;

            // Kiểm tra: Không rỗng VÀ (không phải số HOẶC không đúng định dạng regex)
            if (sdtValue.trim() !== "" && (!(/^\d+$/.test(sdtValue)) || !sdtRegex.test(sdtValue))) {
                sdtInput.addClass("is-invalid");
                $("#sdtErrorMessage").text("Số điện thoại không đúng định dạng.");
                isValid = false;
            }

            if (!isValid) {
                e.preventDefault(); // Chặn submit nếu có lỗi
                return false;
            }
            return true;
        });
    });
</script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}